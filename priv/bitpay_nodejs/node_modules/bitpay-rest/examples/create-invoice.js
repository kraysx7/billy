var fs         = require('fs');
var HOME       = process.env['HOME'];
var bitauth    = require('bitauth');
var bitpay     = require('../index');
var encPrivkey = fs.readFileSync(HOME + '/.bitpay/api.key').toString();
var privkey    = bitauth.decrypt('', encPrivkey); // decrypt with your key pass
var client     = bitpay.createClient(privkey);

var data = {
  price: process.argv[2],
  currency: process.argv[3],
  posData: JSON.stringify({ref: process.argv[4]}),
  notificationURL: process.argv[5], // 'https://gocs.pro/payment/bitpay/notification',
  redirectURL: process.argv[6]
};

client.on('error', function(err) {
    console.log(err);
});

client.on('ready', function() {

  client.as('merchant').post('invoices', data, function(err, invoice) {
    console.log(JSON.stringify(err || invoice));
    // console.log(err || invoice);
  });

});
